<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©è¯»ä»»åŠ¡æ¿</title>
    <!-- å¼•å…¥ Quill æ ·å¼ï¼Œä¿è¯æ ¼å¼è¿˜åŸ -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        html, body { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', Tahoma, Arial, sans-serif; background-color: #f0f2f5; scroll-snap-type: y mandatory; scroll-behavior: smooth; }
        .section { height: 100vh; width: 100%; box-sizing: border-box; padding: 20px 40px; scroll-snap-align: start; display: flex; flex-direction: column; position: relative; }
        
        .section-reading { background-color: #fff; border-bottom: 5px solid #007bff; }
        .section-dictation { background-color: #fff; border-top: 5px solid #dc3545; }
        
        h2 { font-size: 2em; margin: 0 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #eee; flex-shrink: 0; }
        .section-reading h2 { color: #007bff; border-color: #007bff; }
        .section-dictation h2 { color: #dc3545; border-color: #dc3545; }

        /* å†…å®¹åŒºåŸŸæ ·å¼è°ƒæ•´ */
        /* ql-editor æ˜¯ Quill çš„æ ‡å‡†ç±»åï¼Œè¿™é‡Œç”¨æ¥ç»§æ‰¿æ ·å¼ */
        .content-area { 
            flex: 1; 
            overflow-y: auto; 
            font-size: 1.5em; /* é»˜è®¤å¤§å­—å· */
            padding: 10px;
        }
        
        /* é’ˆå¯¹å›¾ç‰‡çš„æ ·å¼ä¼˜åŒ–ï¼Œé˜²æ­¢å›¾ç‰‡è¿‡å¤§æ’‘ç ´å±å¹• */
        .content-area img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 10px 0;
        }

        .locked-area { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #fafafa; border: 4px dashed #ddd; border-radius: 20px; color: #888; }
        .timer { font-size: 4em; font-weight: bold; color: #dc3545; margin: 20px 0; }
        .server-time-tag { font-size: 0.4em; background: #eee; padding: 5px 15px; border-radius: 20px; vertical-align: middle; color: #666; font-weight: normal; margin-left: 20px; }
        .hidden { display: none !important; }
        .arrow-down { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); font-size: 2em; color: #ccc; animation: bounce 2s infinite; cursor: pointer; z-index: 10;}
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);} 40% {transform: translateX(-50%) translateY(-10px);} 60% {transform: translateX(-50%) translateY(-5px);} }
    </style>
</head>
<body>

    <!-- ç¬¬ä¸€å± -->
    <div class="section section-reading">
        <h2>ğŸ“– æ—©è¯»ä»»åŠ¡</h2>
        <!-- æ·»åŠ  ql-editor å’Œ ql-snow ç±»ï¼Œç¡®ä¿å¯Œæ–‡æœ¬æ ·å¼ç”Ÿæ•ˆ -->
        <div id="reading" class="content-area ql-editor ql-snow">
            æ­£åœ¨è¿æ¥æœåŠ¡å™¨...
        </div>
        <div class="arrow-down" onclick="window.scrollTo(0, window.innerHeight)">â¬‡ï¸ é»˜å†™åœ¨ä¸‹é¢</div>
    </div>

    <!-- ç¬¬äºŒå± -->
    <div class="section section-dictation">
        <h2>
            âœï¸ é»˜å†™ä»»åŠ¡ 
            <span class="server-time-tag">ğŸ•’ ç½‘ç»œæ—¶é—´ç®¡æ§</span>
        </h2>
        
        <div id="dictation" class="content-area ql-editor ql-snow hidden"></div>

        <div id="lock" class="locked-area">
            <span style="font-size: 2em;">ğŸ”’ ä»»åŠ¡é”å®šä¸­</span>
            <div id="status-text" class="timer">--/-- --:--</div>
            <div style="font-size: 1.2em">
                å¼€æ”¾æ—¶é—´: <span id="target-time" style="font-weight:bold; color:#333">--</span>
            </div>
        </div>
    </div>

    <script>
        function loadTask() {
            fetch('data.json?t=' + new Date().getTime())
                .then(response => {
                    const serverDateStr = response.headers.get('Date');
                    if (!serverDateStr) throw new Error("æ— æ³•è·å–æœåŠ¡å™¨æ—¶é—´");
                    const serverTime = new Date(serverDateStr);
                    return response.json().then(data => ({ data, serverTime }));
                })
                .then(({ data, serverTime }) => {
                    // ã€å…³é”®ä¿®æ”¹ã€‘ä½¿ç”¨ innerHTML æ¥æ¸²æŸ“å¯Œæ–‡æœ¬ï¼ˆHTMLä»£ç ï¼‰
                    document.getElementById('reading').innerHTML = data.reading;
                    document.getElementById('target-time').innerText = data.open_datetime ? data.open_datetime.replace('T', ' ') : "æœªè®¾å®š";
                    checkTime(data, serverTime);
                })
                .catch(err => console.error("åŠ è½½ä¸­...", err));
        }

        function checkTime(data, serverTime) {
            if (!data.open_datetime) return;
            let beijingTime = new Date(serverTime.getTime() + 8 * 60 * 60 * 1000);
            const pad = n => n.toString().padStart(2, '0');
            const currentStr = 
                beijingTime.getUTCFullYear() + "-" + 
                pad(beijingTime.getUTCMonth() + 1) + "-" + 
                pad(beijingTime.getUTCDate()) + "T" + 
                pad(beijingTime.getUTCHours()) + ":" + 
                pad(beijingTime.getUTCMinutes());

            const targetStr = data.open_datetime;
            const dictationDiv = document.getElementById('dictation');
            const lockDiv = document.getElementById('lock');
            const statusText = document.getElementById('status-text');

            if (currentStr >= targetStr) {
                // ã€å…³é”®ä¿®æ”¹ã€‘ä½¿ç”¨ innerHTML
                dictationDiv.innerHTML = data.dictation;
                dictationDiv.classList.remove('hidden');
                lockDiv.classList.add('hidden');
            } else {
                dictationDiv.classList.add('hidden');
                lockDiv.classList.remove('hidden');
                statusText.innerText = currentStr.replace('T', ' '); 
            }
        }

        loadTask();
        setInterval(loadTask, 5000);
    </script>
</body>
</html>
