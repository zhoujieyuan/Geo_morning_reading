<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©è¯»ä»»åŠ¡æ¿</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f4f4f9; padding: 20px; margin: 0; }
        .container { display: flex; gap: 20px; max-width: 1400px; margin: 0 auto; height: 90vh; }
        .box { flex: 1; background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 15px; margin-top: 0; }
        .content { font-size: 1.6em; line-height: 1.6; white-space: pre-wrap; color: #333; flex: 1; overflow-y: auto; }
        
        .left h2 { color: #007bff; border-color: #007bff; }
        .right h2 { color: #dc3545; border-color: #dc3545; }

        .locked-area { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #fafafa; border: 2px dashed #ddd; color: #888; }
        .timer { font-size: 2.5em; font-weight: bold; color: #dc3545; margin: 10px 0; font-variant-numeric: tabular-nums; }
        .server-time-tag { background: #eee; padding: 2px 8px; border-radius: 4px; font-size: 0.6em; color: #666; vertical-align: middle; margin-left: 10px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">
        <!-- æ—©è¯»åŒº -->
        <div class="box left">
            <h2>ğŸ“– æ—©è¯»ä»»åŠ¡</h2>
            <div id="reading" class="content">æ­£åœ¨è¿æ¥æœåŠ¡å™¨...</div>
        </div>

        <!-- é»˜å†™åŒº -->
        <div class="box right">
            <h2>
                âœï¸ é»˜å†™ä»»åŠ¡ 
                <span class="server-time-tag">ğŸ•’ ç½‘ç»œæ—¶é—´ç®¡æ§ä¸­</span>
            </h2>
            
            <div id="dictation" class="content hidden"></div>

            <div id="lock" class="locked-area">
                <span>ğŸ”’ é»˜å†™ä»»åŠ¡é”å®šä¸­</span>
                <div id="status-text" class="timer">--:--</div>
                <div style="font-size: 0.9em">å°†åœ¨ <span id="target-time">--:--</span> è‡ªåŠ¨å¼€å¯</div>
                <div style="font-size: 0.8em; color: #aaa; margin-top: 5px;">(ä¿®æ”¹æœ¬æœºæ—¶é—´æ— æ•ˆ)</div>
            </div>
        </div>
    </div>

    <script>
        function loadTask() {
            // è¯·æ±‚ GitHub æ–‡ä»¶
            fetch('data.json?t=' + new Date().getTime())
                .then(response => {
                    // === æ ¸å¿ƒé˜²ä½œå¼Šé€»è¾‘ ===
                    // ä¸è·å–æœ¬åœ° new Date()ï¼Œè€Œæ˜¯è·å– GitHub å“åº”å¤´é‡Œçš„ 'Date'
                    // è¿™ä¸ªæ—¶é—´æ˜¯ GitHub æœåŠ¡å™¨çš„æ—¶é—´ (GMTæ ‡å‡†æ—¶é—´)
                    const serverDateStr = response.headers.get('Date');
                    if (!serverDateStr) throw new Error("æ— æ³•è·å–æœåŠ¡å™¨æ—¶é—´");
                    
                    const serverTime = new Date(serverDateStr);
                    return response.json().then(data => ({ data, serverTime }));
                })
                .then(({ data, serverTime }) => {
                    // 1. æ›´æ–°æ—©è¯»
                    document.getElementById('reading').innerText = data.reading;
                    document.getElementById('target-time').innerText = data.open_time;

                    // 2. æ£€æŸ¥æ—¶é—´ (ä¼ å…¥æœåŠ¡å™¨æ—¶é—´)
                    checkTime(data, serverTime);
                })
                .catch(err => console.error("åŠ è½½ä¸­...", err));
        }

        function checkTime(data, serverTime) {
            // å°† GitHub çš„ GMT æ—¶é—´è½¬æ¢ä¸º åŒ—äº¬æ—¶é—´ (GMT+8)
            // è·å– UTC çš„å°æ—¶å¹¶ +8
            let beijingHours = serverTime.getUTCHours() + 8;
            if (beijingHours >= 24) beijingHours -= 24;
            
            // è¡¥é›¶æ“ä½œï¼Œæ‹¼æˆ "08:30" è¿™ç§æ ¼å¼
            const hh = beijingHours.toString().padStart(2, '0');
            const mm = serverTime.getUTCMinutes().toString().padStart(2, '0');
            const currentServerHM = `${hh}:${mm}`;

            const dictationDiv = document.getElementById('dictation');
            const lockDiv = document.getElementById('lock');
            const statusText = document.getElementById('status-text');

            // æ¯”è¾ƒï¼šæœåŠ¡å™¨æ—¶é—´ >= è®¾å®šæ—¶é—´
            if (currentServerHM >= data.open_time) {
                dictationDiv.innerText = data.dictation;
                dictationDiv.classList.remove('hidden');
                lockDiv.classList.add('hidden');
            } else {
                dictationDiv.classList.add('hidden');
                lockDiv.classList.remove('hidden');
                // æ˜¾ç¤ºå½“å‰æœåŠ¡å™¨æ—¶é—´
                statusText.innerText = `å½“å‰æœåŠ¡å™¨æ—¶é—´ ${currentServerHM}`;
            }
        }

        // é¦–æ¬¡è¿è¡Œ
        loadTask();

        // æ¯ 5 ç§’å‘ GitHub è¯¢é—®ä¸€æ¬¡æ—¶é—´
        // æ—¢ç„¶è¦é˜²ä½œå¼Šï¼Œå°±å¿…é¡»é¢‘ç¹é—®æœåŠ¡å™¨ï¼Œè€Œä¸èƒ½ä¾èµ–æœ¬åœ°å€’è®¡æ—¶
        setInterval(loadTask, 5000);

    </script>
</body>
</html>
