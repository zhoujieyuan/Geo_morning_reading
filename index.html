<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©è¯»ä»»åŠ¡æ¿</title>
    <!-- å¼•å…¥ Bootstrap æ ·å¼ï¼Œä¿è¯æ’ç‰ˆå’Œæ•™å¸ˆç«¯ä¸€è‡´ -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html, body { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', Tahoma, Arial, sans-serif; background-color: #f0f2f5; scroll-snap-type: y mandatory; scroll-behavior: smooth; }
        
        /* æ¯ä¸€å±çš„æ ·å¼ */
        .section { 
            height: 100vh; width: 100%; box-sizing: border-box; padding: 20px 50px; 
            scroll-snap-align: start; display: flex; flex-direction: column; position: relative; 
        }
        
        .section-reading { background-color: #fff; border-bottom: 5px solid #007bff; }
        .section-dictation { background-color: #fff; border-top: 5px solid #dc3545; }
        
        h2 { font-size: 2.5em; margin: 0 0 20px 0; padding-bottom: 15px; border-bottom: 2px solid #eee; flex-shrink: 0; }
        .section-reading h2 { color: #007bff; border-color: #007bff; }
        .section-dictation h2 { color: #dc3545; border-color: #dc3545; }

        /* å†…å®¹æ˜¾ç¤ºåŒºï¼šè¿™é‡Œæ˜¯æ ¸å¿ƒ */
        .content-area { 
            flex: 1; 
            overflow-y: auto; 
            font-size: 1.6em; /* é»˜è®¤å­—å·åŠ å¤§ */
            line-height: 1.6;
            color: #333;
        }

        /* ä¿®å¤æµ®åŠ¨å…ƒç´ å¯èƒ½å¯¼è‡´çš„é«˜åº¦å¡Œé™· */
        .content-area::after { content: ""; display: table; clear: both; }

        /* å›¾ç‰‡æ ·å¼ä¼˜åŒ– */
        .content-area img {
            max-width: 100% !important; /* é˜²æ­¢å›¾ç‰‡æ’‘çˆ†å±å¹• */
            height: auto !important;
            margin: 10px;
        }

        /* é”å®šåŒºæ ·å¼ */
        .locked-area { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #fafafa; border: 4px dashed #ddd; border-radius: 20px; color: #888; }
        .timer { font-size: 4em; font-weight: bold; color: #dc3545; margin: 20px 0; font-family: monospace;}
        .server-time-tag { font-size: 0.4em; background: #eee; padding: 5px 15px; border-radius: 20px; vertical-align: middle; color: #666; font-weight: normal; margin-left: 20px; }
        .hidden { display: none !important; }
        
        .arrow-down { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); font-size: 2em; color: #ccc; animation: bounce 2s infinite; cursor: pointer; z-index: 10;}
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);} 40% {transform: translateX(-50%) translateY(-10px);} 60% {transform: translateX(-50%) translateY(-5px);} }
    </style>
</head>
<body>

    <!-- ç¬¬ä¸€å±ï¼šæ—©è¯» -->
    <div class="section section-reading">
        <h2>ğŸ“– æ—©è¯»ä»»åŠ¡</h2>
        <div id="reading" class="content-area">
            æ­£åœ¨åŠ è½½å›¾æ–‡ä»»åŠ¡...
        </div>
        <div class="arrow-down" onclick="window.scrollTo(0, window.innerHeight)">â¬‡ï¸ é»˜å†™åœ¨ä¸‹é¢</div>
    </div>

    <!-- ç¬¬äºŒå±ï¼šé»˜å†™ -->
    <div class="section section-dictation">
        <h2>
            âœï¸ é»˜å†™ä»»åŠ¡ 
            <span class="server-time-tag">ğŸ•’ ç½‘ç»œæ—¶é—´ç®¡æ§</span>
        </h2>
        
        <div id="dictation" class="content-area hidden"></div>

        <div id="lock" class="locked-area">
            <span style="font-size: 2em;">ğŸ”’ ä»»åŠ¡é”å®šä¸­</span>
            <div id="status-text" class="timer">--/-- --:--</div>
            <div style="font-size: 1.2em">
                å¼€æ”¾æ—¶é—´: <span id="target-time" style="font-weight:bold; color:#333">--</span>
            </div>
        </div>
    </div>

    <script>
        // === é€»è¾‘éƒ¨åˆ†å®Œå…¨ä¿æŒä¸å˜ ===
        function loadTask() {
            fetch('data.json?t=' + new Date().getTime())
                .then(response => {
                    const serverDateStr = response.headers.get('Date');
                    if (!serverDateStr) throw new Error("æ— æ—¶é—´");
                    const serverTime = new Date(serverDateStr);
                    return response.json().then(data => ({ data, serverTime }));
                })
                .then(({ data, serverTime }) => {
                    // ä½¿ç”¨ innerHTML æ¸²æŸ“åŒ…å«æ ·å¼çš„ HTML
                    document.getElementById('reading').innerHTML = data.reading;
                    document.getElementById('target-time').innerText = data.open_datetime ? data.open_datetime.replace('T', ' ') : "æœªè®¾å®š";
                    checkTime(data, serverTime);
                })
                .catch(err => console.error("Loading...", err));
        }

        function checkTime(data, serverTime) {
            if (!data.open_datetime) return;
            let beijingTime = new Date(serverTime.getTime() + 8 * 60 * 60 * 1000);
            const pad = n => n.toString().padStart(2, '0');
            const currentStr = 
                beijingTime.getUTCFullYear() + "-" + 
                pad(beijingTime.getUTCMonth() + 1) + "-" + 
                pad(beijingTime.getUTCDate()) + "T" + 
                pad(beijingTime.getUTCHours()) + ":" + 
                pad(beijingTime.getUTCMinutes());

            const dictationDiv = document.getElementById('dictation');
            const lockDiv = document.getElementById('lock');
            const statusText = document.getElementById('status-text');

            if (currentStr >= data.open_datetime) {
                dictationDiv.innerHTML = data.dictation;
                dictationDiv.classList.remove('hidden');
                lockDiv.classList.add('hidden');
            } else {
                dictationDiv.classList.add('hidden');
                lockDiv.classList.remove('hidden');
                statusText.innerText = currentStr.replace('T', ' '); 
            }
        }

        loadTask();
        setInterval(loadTask, 5000);
    </script>
</body>
</html>
