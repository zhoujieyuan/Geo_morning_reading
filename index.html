<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©è¯»ä»»åŠ¡æ¿</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f4f4f9; padding: 20px; margin: 0; }
        .container { display: flex; gap: 20px; max-width: 1400px; margin: 0 auto; height: 90vh; }
        .box { flex: 1; background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        
        h2 { border-bottom: 2px solid #eee; padding-bottom: 15px; margin-top: 0; }
        .content { font-size: 1.6em; line-height: 1.6; white-space: pre-wrap; color: #333; flex: 1; overflow-y: auto; }

        /* é¢œè‰²åŒºåˆ† */
        .left h2 { color: #007bff; border-color: #007bff; }
        .right h2 { color: #dc3545; border-color: #dc3545; }

        /* é”å®šçŠ¶æ€æ ·å¼ */
        .locked-area { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #fafafa; border: 2px dashed #ddd; color: #888; }
        .timer { font-size: 3em; font-weight: bold; color: #dc3545; margin: 10px 0; font-variant-numeric: tabular-nums; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">
        <!-- æ—©è¯»åŒº -->
        <div class="box left">
            <h2>ğŸ“– æ—©è¯»ä»»åŠ¡</h2>
            <div id="reading" class="content">æ­£åœ¨è·å–ä»»åŠ¡...</div>
        </div>

        <!-- é»˜å†™åŒº -->
        <div class="box right">
            <h2>âœï¸ é»˜å†™ä»»åŠ¡</h2>
            
            <!-- é»˜å†™å†…å®¹ (é»˜è®¤éšè—) -->
            <div id="dictation" class="content hidden"></div>

            <!-- é”å®šæç¤º (é»˜è®¤æ˜¾ç¤º) -->
            <div id="lock" class="locked-area">
                <span>ğŸ”’ é»˜å†™å€’è®¡æ—¶</span>
                <div id="countdown" class="timer">--:--:--</div>
                <div style="font-size: 0.9em">å°†åœ¨ <span id="target-time">--:--</span> è‡ªåŠ¨å¼€å¯</div>
            </div>
        </div>
    </div>

    <script>
        // é˜²æ­¢ç¼“å­˜çš„è·å–å‡½æ•°
        function loadTask() {
            // åŠ ä¸ªæ—¶é—´æˆ³ï¼Œå¼ºåˆ¶GitHubè¿”å›æœ€æ–°æ•°æ®
            fetch('data.json?t=' + new Date().getTime())
                .then(res => res.json())
                .then(data => {
                    // 1. æ›´æ–°æ—©è¯»å†…å®¹
                    document.getElementById('reading').innerText = data.reading;
                    document.getElementById('target-time').innerText = data.open_time;

                    // 2. æ£€æŸ¥æ—¶é—´å†³å®šæ˜¯å¦æ˜¾ç¤ºé»˜å†™
                    checkTime(data);
                })
                .catch(err => console.error("ç½‘ç»œåŠ è½½ä¸­..."));
        }

        // æ ¸å¿ƒæ—¶é—´æ£€æŸ¥é€»è¾‘
        function checkTime(data) {
            const now = new Date();
            // è·å–å½“å‰ HH:mm æ ¼å¼
            const currentHM = now.toTimeString().substring(0, 5);
            
            const dictationDiv = document.getElementById('dictation');
            const lockDiv = document.getElementById('lock');
            const countdownDiv = document.getElementById('countdown');

            // å¦‚æœå½“å‰æ—¶é—´ >= è®¾å®šçš„å¼€æ”¾æ—¶é—´
            if (currentHM >= data.open_time) {
                dictationDiv.innerText = data.dictation;
                dictationDiv.classList.remove('hidden');
                lockDiv.classList.add('hidden');
            } else {
                // è¿˜æ²¡åˆ°æ—¶é—´
                dictationDiv.classList.add('hidden');
                lockDiv.classList.remove('hidden');
                // æ˜¾ç¤ºå€’è®¡æ—¶ï¼ˆåªæ˜¯æ˜¾ç¤ºå½“å‰æ—¶é—´ï¼Œæç¤ºè¿˜åœ¨ç­‰å¾…ï¼‰
                countdownDiv.innerText = now.toTimeString().substring(0, 8);
            }
        }

        // é¦–æ¬¡åŠ è½½
        loadTask();

        // æ¯ 1 ç§’æ£€æŸ¥ä¸€æ¬¡æ—¶é—´ï¼ˆç”¨äºå€’è®¡æ—¶ï¼‰
        setInterval(() => {
            // è¿™é‡Œæˆ‘ä»¬åªé‡æ–°è¿è¡Œæ—¶é—´æ£€æŸ¥é€»è¾‘ï¼Œä¸é¢‘ç¹è¯·æ±‚ç½‘ç»œ
            // ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬æ¯5ç§’è¯·æ±‚ä¸€æ¬¡ç½‘ç»œï¼Œæ¯1ç§’æ›´æ–°ä¸€æ¬¡å€’è®¡æ—¶ç•Œé¢
            const countdownDiv = document.getElementById('countdown');
            countdownDiv.innerText = new Date().toTimeString().substring(0, 8);
        }, 1000);

        // æ¯ 10 ç§’å» GitHub æ£€æŸ¥ä¸€æ¬¡æœ‰æ²¡æœ‰æ–°ä»»åŠ¡
        setInterval(loadTask, 10000);

    </script>
</body>
</html>
