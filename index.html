<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©è¯»ä»»åŠ¡æ¿</title>
    <style>
        html, body { margin: 0; padding: 0; height: 100%; background-color: #333; overflow: hidden; font-family: 'Segoe UI', sans-serif;}

        /* æ»‘åŠ¨å®¹å™¨ */
        .slider-container {
            width: 100vw;
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }

        /* æ¯ä¸€å± */
        .section {
            width: 100vw;
            height: 100vh;
            scroll-snap-align: start;
            position: relative;
            background: #fff;
            overflow: hidden; /* ç¦æ­¢å‡ºç°æ»šåŠ¨æ¡ï¼Œä¿æŒç”»å¸ƒå®Œæ•´ */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ç”»å¸ƒå®¹å™¨ (Scaler) */
        /* æˆ‘ä»¬è®¾è®¡çš„æ˜¯ 1000x562ï¼Œè¿™é‡Œé€šè¿‡ CSS Transform æ”¾å¤§åˆ°å…¨å± */
        .canvas-scaler {
            width: 1000px;
            height: 562px;
            position: relative;
            background-color: white;
            /* è°ƒè¯•ç”¨è¾¹æ¡†ï¼Œå®é™…å¯å»æ‰ */
            /* border: 1px dashed #eee; */
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  (æ‚¬æµ®åœ¨ç”»å¸ƒä¹‹ä¸Š) */
        .header-bar {
            position: absolute;
            top: 0; left: 0; width: 100%;
            height: 60px;
            z-index: 100;
            display: flex;
            align-items: center;
            padding: 0 30px;
            background: rgba(255,255,255,0.9);
            border-bottom: 2px solid #eee;
            box-sizing: border-box;
        }
        .header-title { font-size: 24px; font-weight: bold; margin: 0; }
        .blue-theme { border-bottom-color: #007bff; color: #007bff; }
        .red-theme { border-bottom-color: #dc3545; color: #dc3545; }

        /* å†…å®¹æ¸²æŸ“åŒº */
        .content-layer {
            position: absolute;
            top: 60px; /* è®©å‡ºæ ‡é¢˜ä½ç½® */
            left: 0;
            width: 1000px;
            height: 502px; /* 562 - 60 */
            position: relative;
        }

        /* é”å®šé®ç½© */
        .locked-mask {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.98);
            z-index: 200;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #888;
        }
        .timer { font-size: 5em; font-weight: bold; color: #dc3545; margin: 10px 0; font-family: monospace; }
        
        .arrow-down { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 2em; color: #ccc; animation: bounce 2s infinite; cursor: pointer; z-index: 999; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);} 40% {transform: translateX(-50%) translateY(-10px);} 60% {transform: translateX(-50%) translateY(-5px);} }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="slider-container">
    <!-- ç¬¬ä¸€å±ï¼šæ—©è¯» -->
    <div class="section">
        <div class="canvas-scaler" id="scaler-1">
            <div class="header-bar blue-theme">
                <span class="header-title">ğŸ“– æ—©è¯»ä»»åŠ¡</span>
            </div>
            <div id="reading-content" class="content-layer">
                <!-- è¿™é‡Œçš„ HTML å†…å®¹æ˜¯ç»å¯¹å®šä½çš„ï¼Œä½ç½®å›ºå®š -->
                <div style="padding:50px; text-align:center; color:#999;">æ­£åœ¨åŠ è½½è®¾è®¡å›¾...</div>
            </div>
        </div>
        <div class="arrow-down" onclick="document.querySelector('.slider-container').scrollBy(0, window.innerHeight)">â¬‡ï¸ é»˜å†™åœ¨ä¸‹é¢</div>
    </div>

    <!-- ç¬¬äºŒå±ï¼šé»˜å†™ -->
    <div class="section">
        <div class="canvas-scaler" id="scaler-2">
            <div class="header-bar red-theme">
                <span class="header-title">âœï¸ é»˜å†™ä»»åŠ¡</span>
                <span style="font-size:0.6em; background:#eee; padding:2px 10px; border-radius:10px; margin-left:15px; color:#666;">ğŸ•’ ç½‘ç»œç®¡æ§</span>
            </div>
            
            <div id="dictation-content" class="content-layer hidden"></div>

            <!-- é”å®šé®ç½© -->
            <div id="lock" class="locked-mask">
                <span style="font-size: 2em;">ğŸ”’ ä»»åŠ¡é”å®šä¸­</span>
                <div id="status-text" class="timer">--:--</div>
                <div style="font-size: 1.2em">å¼€æ”¾æ—¶é—´: <span id="target-time" style="font-weight:bold; color:#333">--</span></div>
            </div>
        </div>
    </div>
</div>

<script>
    // === æ ¸å¿ƒé€»è¾‘ï¼šè‡ªåŠ¨ç¼©æ”¾ç”»å¸ƒä»¥é€‚åº”å±å¹• ===
    function resizeCanvas() {
        const scalers = document.querySelectorAll('.canvas-scaler');
        const screenW = window.innerWidth;
        const screenH = window.innerHeight;
        
        // ç›®æ ‡æ˜¯ 1000x562
        const targetW = 1000;
        const targetH = 562;

        // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼šæˆ‘ä»¬è¦è®©ç”»å¸ƒå°½å¯èƒ½å¤§ï¼Œå¡«æ»¡å±å¹•ï¼Œä½†ä¿æŒæ¯”ä¾‹
        const scaleX = screenW / targetW;
        const scaleY = screenH / targetH;
        const scale = Math.min(scaleX, scaleY); // é€‰è¾ƒå°çš„é‚£ä¸ªæ¯”ä¾‹ï¼Œä¿è¯å†…å®¹æ˜¾ç¤ºå…¨

        scalers.forEach(el => {
            el.style.transform = `scale(${scale})`;
        });
    }

    // çª—å£å¤§å°æ”¹å˜æ—¶è‡ªåŠ¨é‡ç®—
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas(); // åˆå§‹åŒ–æ‰§è¡Œä¸€æ¬¡

    // === æ•°æ®é€»è¾‘ ===
    function loadTask() {
        fetch('data.json?t=' + new Date().getTime())
            .then(res => {
                const serverDateStr = res.headers.get('Date');
                const serverTime = serverDateStr ? new Date(serverDateStr) : new Date();
                return res.json().then(data => ({ data, serverTime }));
            })
            .then(({ data, serverTime }) => {
                // æ¸²æŸ“ HTML å†…å®¹ (é‡Œé¢åŒ…å«äº†ç»å¯¹å®šä½çš„ style)
                if(data.reading_html) document.getElementById('reading-content').innerHTML = data.reading_html;
                document.getElementById('target-time').innerText = data.open_datetime ? data.open_datetime.replace('T', ' ') : "æœªè®¾å®š";
                checkTime(data, serverTime);
            })
            .catch(err => console.error(err));
    }

    function checkTime(data, serverTime) {
        if (!data.open_datetime) return;
        let beijingTime = new Date(serverTime.getTime() + 8 * 60 * 60 * 1000);
        const pad = n => n.toString().padStart(2, '0');
        const currentStr = 
            beijingTime.getUTCFullYear() + "-" + 
            pad(beijingTime.getUTCMonth() + 1) + "-" + 
            pad(beijingTime.getUTCDate()) + "T" + 
            pad(beijingTime.getUTCHours()) + ":" + 
            pad(beijingTime.getUTCMinutes());

        const dictationDiv = document.getElementById('dictation-content');
        const lockDiv = document.getElementById('lock');
        const statusText = document.getElementById('status-text');

        if (currentStr >= data.open_datetime) {
            if(data.dictation_html) dictationDiv.innerHTML = data.dictation_html;
            dictationDiv.classList.remove('hidden');
            lockDiv.classList.add('hidden');
        } else {
            dictationDiv.classList.add('hidden');
            lockDiv.classList.remove('hidden');
            statusText.innerText = currentStr.replace('T', ' '); 
        }
    }

    loadTask();
    setInterval(loadTask, 5000);
</script>
</body>
</html>
