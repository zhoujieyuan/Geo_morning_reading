<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—©è¯»ä»»åŠ¡æ¿</title>
    <style>
        html, body { margin: 0; padding: 0; height: 100%; background-color: #222; overflow: hidden; font-family: 'Segoe UI', sans-serif;}

        /* æ»‘åŠ¨å®¹å™¨ */
        .slider-container {
            width: 100vw; height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            /* éšè—æ»šåŠ¨æ¡ */
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        .slider-container::-webkit-scrollbar { display: none; }

        /* æ¯ä¸€å± */
        .section {
            width: 100vw; height: 100vh;
            scroll-snap-align: start;
            position: relative;
            background: #000; /* èƒŒæ™¯é»‘ï¼Œçªå‡ºç”»å¸ƒ */
            display: flex; justify-content: center; align-items: center;
        }

        /* ç”»å¸ƒå®¹å™¨ (Scaler) - çº¯å‡€çš„ 16:9 å®¹å™¨ */
        .canvas-scaler {
            width: 1000px; height: 562px;
            position: relative;
            background-color: white; /* ç”»å¸ƒèƒŒæ™¯ç™½ */
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden; 
        }

        /* å†…å®¹æ¸²æŸ“åŒº - ç°åœ¨å æ»¡ 100% ç©ºé—´ */
        .content-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
        }

        /* é”å®šé®ç½© (é»˜å†™æœªå¼€æ”¾æ—¶æ˜¾ç¤º) */
        .locked-mask {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #f8f9fa; /* æµ…ç°èƒŒæ™¯ */
            z-index: 200;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #555;
            border: 5px solid #dc3545; /* çº¢è‰²è¾¹æ¡†æç¤ºé”å®š */
            box-sizing: border-box;
        }
        .timer { font-size: 6em; font-weight: bold; color: #dc3545; margin: 20px 0; font-family: monospace; }
        
        /* ç¿»é¡µç®­å¤´ */
        .arrow-down { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
            font-size: 3em; color: rgba(255,255,255,0.5); 
            animation: bounce 2s infinite; cursor: pointer; z-index: 999; 
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);} 40% {transform: translateX(-50%) translateY(-10px);} 60% {transform: translateX(-50%) translateY(-5px);} }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="slider-container">
    <!-- ç¬¬ä¸€å±ï¼šæ—©è¯» (çº¯å‡€) -->
    <div class="section">
        <div class="canvas-scaler">
            <div id="reading-content" class="content-layer">
                <!-- è¿™é‡Œä¼šæ˜¾ç¤ºä½ åœ¨æ•™å¸ˆç«¯è®¾è®¡çš„ç”»é¢ -->
            </div>
        </div>
        <div class="arrow-down" onclick="document.querySelector('.slider-container').scrollBy(0, window.innerHeight)">â¬‡ï¸</div>
    </div>

    <!-- ç¬¬äºŒå±ï¼šé»˜å†™ (çº¯å‡€+é”å®š) -->
    <div class="section">
        <div class="canvas-scaler">
            
            <!-- é»˜å†™å†…å®¹ -->
            <div id="dictation-content" class="content-layer hidden"></div>

            <!-- é”å®šé®ç½© (æ—¶é—´æ²¡åˆ°æ—¶ç›–åœ¨ä¸Šé¢) -->
            <div id="lock" class="locked-mask">
                <span style="font-size: 3em; font-weight:bold;">ğŸ”’ é»˜å†™æœªå¼€å¯</span>
                <div id="status-text" class="timer">--:--</div>
                <div style="font-size: 1.5em; color:#888;">
                    å¼€æ”¾æ—¶é—´: <span id="target-time" style="font-weight:bold; color:#333">--</span>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    // === è‡ªåŠ¨ç¼©æ”¾ç”»å¸ƒ ===
    function resizeCanvas() {
        const scalers = document.querySelectorAll('.canvas-scaler');
        const screenW = window.innerWidth;
        const screenH = window.innerHeight;
        
        // ç›®æ ‡å°ºå¯¸
        const targetW = 1000;
        const targetH = 562;

        const scaleX = screenW / targetW;
        const scaleY = screenH / targetH;
        const scale = Math.min(scaleX, scaleY); 

        scalers.forEach(el => {
            el.style.transform = `scale(${scale})`;
        });
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas(); 

    // === æ•°æ®é€»è¾‘ ===
    function loadTask() {
        fetch('data.json?t=' + new Date().getTime())
            .then(res => {
                const serverDateStr = res.headers.get('Date');
                const serverTime = serverDateStr ? new Date(serverDateStr) : new Date();
                return res.json().then(data => ({ data, serverTime }));
            })
            .then(({ data, serverTime }) => {
                if(data.reading_html) document.getElementById('reading-content').innerHTML = data.reading_html;
                document.getElementById('target-time').innerText = data.open_datetime ? data.open_datetime.replace('T', ' ') : "æœªè®¾å®š";
                checkTime(data, serverTime);
            })
            .catch(err => console.error(err));
    }

    function checkTime(data, serverTime) {
        if (!data.open_datetime) return;
        let beijingTime = new Date(serverTime.getTime() + 8 * 60 * 60 * 1000);
        const pad = n => n.toString().padStart(2, '0');
        const currentStr = 
            beijingTime.getUTCFullYear() + "-" + 
            pad(beijingTime.getUTCMonth() + 1) + "-" + 
            pad(beijingTime.getUTCDate()) + "T" + 
            pad(beijingTime.getUTCHours()) + ":" + 
            pad(beijingTime.getUTCMinutes());

        const dictationDiv = document.getElementById('dictation-content');
        const lockDiv = document.getElementById('lock');
        const statusText = document.getElementById('status-text');

        if (currentStr >= data.open_datetime) {
            // æ—¶é—´åˆ°ï¼šæ˜¾ç¤ºå†…å®¹ï¼Œéšè—é”
            if(data.dictation_html) dictationDiv.innerHTML = data.dictation_html;
            dictationDiv.classList.remove('hidden');
            lockDiv.classList.add('hidden');
        } else {
            // æ—¶é—´æœªåˆ°ï¼šéšè—å†…å®¹ï¼Œæ˜¾ç¤ºé”
            dictationDiv.classList.add('hidden');
            lockDiv.classList.remove('hidden');
            statusText.innerText = currentStr.replace('T', ' '); 
        }
    }

    loadTask();
    setInterval(loadTask, 5000);
</script>
</body>
</html>
